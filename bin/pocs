#!/usr/bin/env bash

set -e

usage() {
  echo -n "
##################################################
# Start POCS via Docker.
##################################################

 $ $(basename $0) [COMMAND]

 Options:
  COMMAND   These options are passed at the end of the docker-compose command.
            To start all service simply pass 'up'.

 Examples:

    # Start all services in the foreground.
    $POCS/bin/pocs up

    #Start specific docker containers in the background with
    $POCS/bin/pocs up --no-deps -d <container name>

    e.g.

    # Start config-server service in the background.
    $POCS/bin/pocs up --no-deps -d config-server

    # Read the logs from the config-server
    $POCS/bin/pocs logs config-server

    # Manually stop docker containers in the with
    docker stop <container name>
"
}

START=${1:-help}
if [ "${START}" = 'help' ] || [ "${START}" = '-h' ] || [ "${START}" = '--help' ]; then
  usage
  exit 1
fi

PARAMS="$@"
CMD="docker-compose -f docker/docker-compose.yaml"

# If user only asked to start, check if already running and if so use "-d" option.
if [[ "$PARAMS" == "up" ]]; then
  PARAMS="up -d"
fi

# Run the docker-compose command with user params.
eval "${CMD} ${PARAMS}"
