version: '3.7'
services:
  pocs:
    image: panoptes-pocs:testing
    build:
      context: ../
      dockerfile: tests/Dockerfile
    init: true
    tty: true
    environment:
      - PANDIR=/POCS
      - POCS=/POCS
      - PANOPTES_CONFIG_FILE=/POCS/tests/testing.yaml
      - PANOPTES_CONFIG_HOST=localhost
      - PANOPTES_CONFIG_PORT=8765
    privileged: true
    network_mode: host
    command: [ "pytest" ]
    volumes:
      - logdir:/POCS/logs
      - builddir:/POCS/build
volumes:
  logdir:
    driver: local
    driver_opts:
      type: none
      device: logs
      o: bind
  builddir:
    driver: local
    driver_opts:
      type: none
      device: build
      o: bind
